<form class="form-horizontal" role="form" ng-submit="methvm.submitMethod()">
<div class="modal-header">
	<h3 class="modal-title">{{ methvm.database.name }} Data Access</h3>
</div>
<div class="modal-body">
	<div class="btn-group" dropdown is-open="methvm.dropdownStatus.isopen">
		<button type="button" class="btn btn-primary dropdown-toggle">
        	{{ methvm.dropdownStatus.active }} <span class="caret"></span>
      	</button>
      	<ul class="dropdown-menu" role="menu">
        	<li ng-repeat="method in methvm.methods">
        		<span ng-click="methvm.setActive(method)" 
        			  ng-class="{ active: methvm.isActive(method.path) }">
        			{{ methvm.trimPath(method.path) }}
        		</span>
        	</li>
      	</ul>
	</div>
    <div class="row text-center">
		<div ng-show="methvm.showError" class="col-sm-12">
			<p>an error occurred while retrieving data: {{ methvm.status }} </p>
			<p>please try again:</p>
			<button ng-click="methvm.retry()" class="btn"><h4>retry</h4></button>
		</div>
		<div ng-show="!methvm.showError" class="col-sm-12">&nbsp;</div>
		<div ng-show="methvm.initialising" class="col-sm-12">
			<img src="/public/img/layout/loading.gif" class="loadingImg-sm" alt="loading..." />
		</div>
	</div>
	<div class="row">
		<div class="col-sm-12">
			<div ng-repeat="operation in methvm.currentMethod.operations" 
				style="max-height: 500px; overflow-y: auto; overflow-x: hidden;">
				<p><strong>{{ operation.summary }}:</strong>&nbsp;&nbsp;{{ operation.notes }}</p>
				<!-- @TODO here we add a directive if paramType == 'query' later -->
				<div ng-if="parameter.paramType == 'query'" class="row form-group" 
					ng-repeat="parameter in operation.parameters">	
					<label class="col-sm-3 control-label">{{ parameter.description }}</label>
					<div class="col-sm-7">
					    <!-- string inputs -->
						<input type="text" class="form-control input-sm" 
							ng-if="(parameter['enum'] | isEmpty) && (parameter.type == 'string')" 
							ng-required="parameter.required" ng-model="methvm.request[parameter.name]"
							tooltip="Requires {{parameter.type}}"
							ng-change="methvm.updateRequest(parameter.name)">
						<!-- dateTime inputs -->
						<input type="text" class="form-control input-sm" style="width: 50%;"
							ng-if="parameter.type == 'dateTime'" 
							ng-required="parameter.required" ng-model="methvm.request[parameter.name]"
							tooltip="Requires ISO-8601 {{parameter.type}}"
							ng-change="methvm.updateRequest(parameter.name)">
						<!-- duration inputs -->
						<input type="text" class="form-control input-sm" style="width: 30%;"
							ng-if="parameter.type == 'duration'" 
							ng-required="parameter.required" ng-model="methvm.request[parameter.name]"
							tooltip="Requires ISO-8601 {{parameter.type}}"
							ng-change="methvm.updateRequest(parameter.name)">
						<!-- number inputs -->
						<input type="number" class="form-control input-sm" style="width: 30%;"
							ng-if="(parameter.type == 'double') || (parameter.type == 'integer') 
								|| (parameter.type == 'number')" 
							ng-required="parameter.required" ng-model="methvm.request[parameter.name]"
							tooltip="Requires {{parameter.type}}"
							ng-change="methvm.updateRequest(parameter.name)">
						<!-- enum inputs -->
					    <select class="form-control input-sm" style="width: 50%;"
					    	ng-if="!(parameter['enum'] | isEmpty)"
					    	ng-options="opt for opt in parameter['enum']" ng-required="parameter.required"
					   		ng-change="methvm.updateRequest(parameter.name)" ng-model="methvm.request[parameter.name]">
					   	</select>
					   	<!-- list inputs -->
						<input type="text" class="form-control input-sm" style="width: 50%;"
							ng-if="(parameter.type.indexOf('list') != -1)" 
							ng-required="parameter.required" ng-model="methvm.request[parameter.name]"
							tooltip="Requires comma-separated {{parameter.type}}"
							ng-change="methvm.updateRequest(parameter.name)">
					</div>
					<label class="col-sm-1 control-label">
						<div class="text-left" ng-if="parameter.required">required</div>
						<div class="text-left" ng-if="!parameter.required">optional</div>
					</label>
				</div>
				<!-- @TODO here we add a directive if paramType == 'body' later (only getVOTableUrl atm) -->
				<div ng-if="parameter.paramType == 'body'" ng-repeat="parameter in operation.parameters" >
					<div class="row form-group">	
						<label class="col-sm-3 control-label">Table Name</label>
						<div class="col-sm-7">
							<input type="text" class="form-control input-sm" 
								ng-required="true" 
								ng-model="methvm.request['Table_name']"
								ng-change="methvm.updateRequest('Table_name')">
						</div>
						<label class="col-sm-1 control-label">required</label>
					</div>
					<div class="row form-group">
						<label class="col-sm-3 control-label">Description</label>
						<div class="col-sm-7">
							<input type="text" class="form-control input-sm" 
								ng-required="true" 
								ng-model="methvm.request['Description']"
								ng-change="methvm.updateRequest('Description')">
						</div>
						<label class="col-sm-1 control-label">required</label>
					</div>
					<div class="row form-group">
						<label class="col-sm-3 control-label">Columns</label>
						<div class="col-sm-7">
							<input type="number" class="form-control input-sm" min="1" style="width: 20%; display: inline-block;"
								ng-change="methvm.refreshVotableHeader()"
								ng-model="methvm.votableColumns" 
								ng-disabled="methvm.votableColumns > 0">
							<button type="button" class="btn btn-success btn-sm" 
								ng-click="methvm.addVotableRow()"
								ng-disabled="methvm.votableColumns == null">Add Row</button>
							<button type="button" class="btn btn-success btn-sm" 
								ng-click="methvm.addVotableColumn()"
								ng-disabled="methvm.votableColumns == null">Add Column</button>
						 	<button type="button" class="btn btn-danger btn-sm" 
								ng-click="methvm.resetVotable()">Reset Table</button>
						</div>
					</div>
					<div class="row">
						<div class="col-sm-10 col-sm-offset-1" style="overflow-x: auto;">
							<table class="table table-striped" ">
								<thead>
									<tr>
										<th class="text-center" ng-repeat="meta in methvm.votableMetadata track by $index">
											<select class="form-control input-sm"
												ng-options="key.name for key in meta" ng-model="methvm.selected[$index]">
					    						<option value="">-- edit metadata --</option>
					   						</select>
					   						<input type="text" class="form-control input-sm" style="margin-top: 5px;"
					   							ng-change="methvm.updateVotableHeader($index)"
					   							ng-model="methvm.selected[$index].value" 
					   							ng-disabled="methvm.selected[$index] == null">
										</th>
										<th style="width: 100px;">&nbsp;</th>
									</tr>
								</thead>
								<tbody>  
									<tr ng-repeat="(rowKey, row) in methvm.votableRows track by rowKey">
										<td class="text-center" ng-repeat="(colKey, col) in row track by colKey">
											<input type="text" class="form-control input-sm"
												value="{{ col }}" ng-model="methvm.votableRows[rowKey][colKey]">
										</td>
										<td class="text-center">
											<button type="button" class="btn btn-danger btn-sm" 
												ng-click="methvm.deleteVotableRow($index)"
												ng-disabled="!methvm.votableColumns">Delete Row</button>
										</td>
									</tr>
								</tbody>
								<tfoot ng-if="methvm.votableRows.length > 0">
									<tr>
										<td class="text-center" ng-repeat="col in methvm.votableRows[0] track by $index">
											<button type="button" class="btn btn-danger btn-sm" 
												ng-click="methvm.deleteVotableColumn($index)">Delete Column</button>
										</td>
										<td>&nbsp;</td>
									</tr>
								</tfoot>
							</table>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<user-data-dir db="{{ methvm.database.id }}"></user-data-dir>
	<div class="row">
	<div class="col-sm-12">
		<div class="btn-group-vertical">
			<div ng-show="methvm.methodsService.loading">
				<img src="/public/img/throbber.gif" alt="loading..."/>
			</div>
			<div class="error" ng-show="methvm.methodsService.showError">{{ methvm.methodsService.status }}</div>
		</div>
	</div>
</div>
</div>
<div class="modal-footer">
	<button type="submit" class="btn btn-primary" 
		ng-show="methvm.dropdownStatus.active != 'Choose Method'">Request Data</button>
	<button type="button" class="btn btn-primary" ng-click="methvm.saveMethods()">Close</button>
	<!-- button type="button" class="btn btn-warning" ng-click="methvm.cancelMethods()">Cancel</button-->
</div>
</form>